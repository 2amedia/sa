(function(){var t=window.BX;if(t["UpdateStepperRegister"])return;var e=new(function(){var e=function(){this.length=0;this.items={};this.order=[];this.state="ready";this.finish=t.delegate(this.finish,this);this.send=t.delegate(this.send,this);this.onSuccess=t.delegate(this.onSuccess,this);this.onFailure=t.delegate(this.onFailure,this)};e.prototype={getQueue:function(e){e+="";return t.util.array_search(e,this.order)},removeItem:function(e){e+="";var s,i;if(typeof this.items[e]!=="undefined"){s=this.items[e];i=this.getQueue(e);this.pointer-=this.pointer>=i?1:0;delete this.items[e];this.order=t.util.deleteFromArray(this.order,i);this.length=this.order.length}return s},getItem:function(t){t+="";return this.items[t]},hasItem:function(t){t+="";return typeof this.items[t]!=="undefined"},setItem:function(e,s){e+="";if(typeof s!=="undefined"){if(typeof this.items[e]==="undefined"){this.order.push(e);this.length=this.order.length}this.items[e]=s;t.addCustomEvent(s,"onFinish",this.finish)}this.exec();return s},getFirst:function(){var t,e=null;for(var s=0;s<this.order.length;s++){t=this.order[s];if(!!t&&this.hasItem(t)){e=this.getItem(t);break}}return e},timeout:0,exec:function(){if(this.timeout>0)clearTimeout(this.timeout);if(this.length>0)this.timeout=setTimeout(t.proxy(this.send,this),5e3)},send:function(){var e=[],s;if(this.length>0){for(var i in this.items){if(this.items.hasOwnProperty(i)){t.onCustomEvent(this,"onPrepare",[e,this])}}}if(e.length>0){t.ajax({method:"POST",dataType:"json",data:{stepper:e},url:"/bitrix/tools/update.php?action=stepper",onsuccess:this.onSuccess,onfailure:this.onFailure})}},onSuccess:function(e){t.onCustomEvent(this,"onSuccess",[e,this]);this.exec()},onFailure:function(e){if(e==="processing")e="Incorrect server response.";t.onCustomEvent(this,"onFailure",[e,this])},finish:function(t){this.removeItem(t)}};return e}()),s=function(){var s=function(s){this.id=s["id"];this.moduleId=s["moduleId"];this["class"]=s["class"];this.onPrepare=t.delegate(this.onPrepare,this);this.onSuccess=t.delegate(this.onSuccess,this);this.onFailure=t.delegate(this.onFailure,this);t.defer_proxy(this.bind,this)();e.setItem(this.id,this);t.addCustomEvent(e,"onPrepare",this.onPrepare);t.addCustomEvent(e,"onSuccess",this.onSuccess);t.addCustomEvent(e,"onFailure",this.onFailure)};s.prototype={show:function(e){if(e["title"]&&t(this.nodes.title))this.nodes.title=e["title"];if(e["progress"]&&t(this.nodes.bar))this.nodes.bar.style.width=e["progress"]+"%";if(e["steps"]&&t(this.nodes.steps))this.nodes.steps.innerHTML=e["steps"]},bindSteps:0,nodes:{container:null,bar:null,steps:null,title:null},bind:function(){if(this.bindSteps>100)return;this.bindSteps++;if(t(this.id+"-steps")){this.nodes.container=t(this.id+"-container");this.nodes.bar=t(this.id+"-bar");this.nodes.steps=t(this.id+"-steps");this.nodes.title=t(this.id+"-title")}else{t.defer_proxy(this.bind,this)()}},hide:function(){if(t(this.nodes.container)){t.addClass(this.nodes.container,"main-stepper-hide");t.removeClass(this.nodes.container,"main-stepper-show")}},finish:function(){t.removeCustomEvent(e,"onPrepare",this.onPrepare);t.removeCustomEvent(e,"onSuccess",this.onSuccess);t.removeCustomEvent(e,"onFailure",this.onFailure);t.onCustomEvent(this,"onFinish",[this.id,this])},onPrepare:function(t){t.push({moduleId:this.moduleId,"class":this["class"]})},onSuccess:function(e){var s={};if(t.type.isArray(e)){for(var i=0;i<e.length;i++){if(e[i]["moduleId"]===this.moduleId&&e[i]["class"]===this["class"]){s=e[i];break}}}if(s["status"]==="continue")this.show(s);else if(s["status"]==="error")this.onFailure(s["message"]);else{this.hide();this.finish()}},onFailure:function(t){this.showError(t);this.finish()},showError:function(e){if(t(this.nodes.title))this.nodes.title.innerHTML=e;if(this.nodes.container)t.addClass(this.nodes.container,"main-stepper-error")}};return s}();t.UpdateStepperRegister=function(t){for(var e=0;e<t.length;e++){new s(t[e])}}})();
//# sourceMappingURL=core_update_stepper.map.js