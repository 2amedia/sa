(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.RowsSortable=function(t){this.parent=null;this.list=null;this.setDefaultProps();this.init(t)};BX.Grid.RowsSortable.prototype={init:function(t){this.parent=t;this.list=this.getList();this.prepareListItems();jsDD.Enable();if(!this.inited){this.inited=true;BX.addCustomEvent("Grid::thereEditedRows",BX.proxy(this.disable,this));BX.addCustomEvent("Grid::noEditedRows",BX.proxy(this.enable,this))}},destroy:function(){BX.removeCustomEvent("Grid::thereEditedRows",BX.proxy(this.disable,this));BX.removeCustomEvent("Grid::noEditedRows",BX.proxy(this.enable,this));this.unregisterObjects()},disable:function(){this.unregisterObjects()},enable:function(){this.reinit()},reinit:function(){this.unregisterObjects();this.setDefaultProps();this.init(this.parent)},getList:function(){return this.parent.getRows().getSourceBodyChild()},unregisterObjects:function(){this.list=this.list.map(function(t){jsDD.unregisterObject(t);jsDD.unregisterDest(t);return t})},prepareListItems:function(){var t=this;this.list=this.list.map(function(s){s.onbxdragstart=BX.delegate(t._onDragStart,t);s.onbxdrag=BX.delegate(t._onDrag,t);s.onbxdragstop=BX.delegate(t._onDragEnd,t);jsDD.registerObject(s);jsDD.registerDest(s);return s})},getIndex:function(t){return BX.Grid.Utils.getIndex(this.list,t)},_onDragStart:function(){this.dragItem=jsDD.current_node;this.dragIndex=this.getIndex(this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Grid.Utils.styleForEach(this.list,{transition:+this.parent.settings.get("animationDuration")+"ms"});BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.addClass(this.parent.getContainer(),this.parent.settings.get("classOnDrag"));BX.addClass(this.dragItem,this.parent.settings.get("classDragActive"))},_onMouseMove:function(t){this.realX=t.clientX;this.realY=t.clientY},_onDrag:function(){var t=this;var s,e;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Grid.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.list.forEach(function(i,r){if(i){s=i.getBoundingClientRect();e=s.top+BX.scrollTop(window)+s.height/2;if(r>t.dragIndex&&t.sortOffset>e&&i.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+-t.offset+"px, 0px)")}if(r<t.dragIndex&&t.sortOffset<e&&i.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+t.offset+"px, 0px)")}if((r<t.dragIndex&&t.sortOffset>e||r>t.dragIndex&&t.sortOffset<e)&&i.style.transform!=="translate3d(0px, 0px, 0px)"){if(i.style.transform!==""){t.targetItem=i}BX.style(i,"transform","translate3d(0px, 0px, 0px)")}}})},_onDragOver:function(){},_onDragLeave:function(){},_onDragEnd:function(){BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.parent.getContainer(),this.parent.settings.get("classOnDrag"));BX.removeClass(this.dragItem,this.parent.settings.get("classDragActive"));BX.Grid.Utils.styleForEach(this.list,{transition:"",transform:""});BX.Grid.Utils.collectionSort(this.dragItem,this.targetItem);this.list=this.getList();this.setDefaultProps();BX.onCustomEvent(this.parent.getContainer(),"Grid::rowMoved",[this.parent])},setDefaultProps:function(){this.dragItem=null;this.targetItem=null;this.dragRect=null;this.dragIndex=null;this.offset=null;this.sortOffset=null;this.realX=null;this.realY=null;this.dragStartOffset=null;this.sortOffset=null}}})();
//# sourceMappingURL=rows-sortable.map.js