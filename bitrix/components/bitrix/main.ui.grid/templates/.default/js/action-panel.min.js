(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.ActionPanel=function(t,e,n){this.parent=null;this.rel={};this.actions=null;this.types=null;this.lastActivated=[];this.init(t,e,n)};BX.Grid.ActionPanel.prototype={init:function(parent,actions,types){this.parent=parent;try{this.actions=eval(actions);this.types=eval(types)}catch(err){}this.bindOnChange();BX.addCustomEvent(window,"Grid::updated",function(){var t=BX("grid_cancel_button");if(t){BX.fireEvent(BX.firstChild(t),"click")}})},resetForAllCheckbox:function(){var t=this.getForAllCheckbox();if(BX.type.isDomNode(t)){t.checked=null}},getForAllCheckbox:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classForAllCheckbox"),true)},getPanel:function(){return BX.Grid.Utils.getByClass(this.parent.getContainer(),this.parent.settings.get("classActionPanel"),true)},getApplyButton:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelApplyButton"),true)},bindOnChange:function(){var t=this;var e=this.getPanel();BX.addCustomEvent(window,"Dropdown::change",function(e,n,i,a,r){if(t.isPanelControl(BX(e))){t._dropdownChange(e,n,i,a,r)}});BX.addCustomEvent(window,"Dropdown::load",function(e,n,i,a,r){if(t.isPanelControl(BX(e))){t._dropdownChange(e,n,i,a,r)}});BX.bind(e,"change",BX.delegate(this._checkboxChange,this));BX.bind(e,"click",BX.delegate(this._clickOnButton,this))},isPanelControl:function(t){return BX.hasClass(t,this.parent.settings.get("classPanelControl"))},getTextInputs:function(){return BX.Grid.Utils.getBySelector(this.getPanel(),'input[type="text"]')},getHiddenInputs:function(){return BX.Grid.Utils.getBySelector(this.getPanel(),'input[type="hidden"]')},getDropdowns:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classDropdown"))},getCheckboxes:function(){return BX.Grid.Utils.getByClass(this.getPanel(),this.parent.settings.get("classPanelCheckbox"))},isDropdown:function(t){return BX.hasClass(t,this.parent.settings.get("classDropdown"))},isCheckbox:function(t){return BX.hasClass(t,this.parent.settings.get("classPanelCheckbox"))},isTextInput:function(t){return t.type==="text"},isHiddenInput:function(t){return t.type==="hidden"},createDropdown:function(t,e){var n=this.createContainer(t.ID,e);var i=BX.create("div",{props:{className:"main-dropdown main-grid-panel-control",id:t.ID+"_control"},attrs:{name:t.NAME,"data-name":t.NAME,"data-items":JSON.stringify(t.ITEMS),"data-value":t.ITEMS[0].VALUE},html:t.ITEMS[0].NAME});n.appendChild(i);return n},createCheckbox:function(t,e){var n=this.createContainer(t.ID,e);var i=BX.create("span",{props:{className:"main-grid-checkbox-container"}});var a=BX.create("span",{props:{className:"main-grid-control-panel-content-title"}});var r=BX.create("input",{props:{type:"checkbox",className:this.parent.settings.get("classPanelCheckbox")+" main-grid-checkbox",id:t.ID+"_control"},attrs:{value:t.VALUE||"",title:t.TITLE||"",name:t.NAME||"","data-onchange":JSON.stringify(t.ONCHANGE)}});r.checked=t.CHECKED||null;n.appendChild(i);n.appendChild(a);i.appendChild(r);i.appendChild(BX.create("label",{props:{className:"main-grid-checkbox"},attrs:{"for":t.ID+"_control",title:t.TITLE}}));a.appendChild(BX.create("label",{attrs:{"for":t.ID+"_control",title:t.TITLE},html:t.LABEL}));return n},createText:function(t,e){var n=this.createContainer(t.ID,e);var i=BX.type.isNotEmptyString(t["TITLE"])?t["TITLE"]:"";if(i!==""){n.appendChild(BX.create("label",{attrs:{title:i,"for":t.ID+"_control"},text:i}))}n.appendChild(BX.create("input",{props:{className:"main-grid-control-panel-input-text main-grid-panel-control",id:t.ID+"_control"},attrs:{name:t.NAME,title:i,placeholder:t.PLACEHOLDER||"",value:t.VALUE||"","data-onchange":JSON.stringify(t.ONCHANGE||[])}}));return n},createHidden:function(t,e){var n=this.createContainer(t.ID,e);n.appendChild(BX.create("input",{props:{id:t.ID+"_control",type:"hidden"},attrs:{name:t.NAME,value:t.VALUE||""}}));return n},createButton:function(t,e){var n=this.createContainer(t.ID,e);var i=BX.create("button",{props:{className:"main-grid-buttons"+(t.CLASS?" "+t.CLASS:""),id:t.id+"_control"},attrs:{name:t.NAME||"","data-onchange":JSON.stringify(t.ONCHANGE||[])},html:t.TEXT});n.appendChild(i);return n},createLink:function(t,e){var n=this.createContainer(t.ID,e);var i=BX.create("a",{props:{className:"main-grid-link"+(t.CLASS?" "+t.CLASS:""),id:t.ID+"_control"},attrs:{href:t.HREF||"","data-onchange":JSON.stringify(t.ONCHANGE||[])},html:t.TEXT});n.appendChild(i);return n},createCustom:function(t,e){},createContainer:function(t,e){t=t.replace("_control","");e=e.replace("_control","");return BX.create("span",{props:{className:this.parent.settings.get("classPanelControlContainer"),id:t},attrs:{"data-relative":e}})},removeItemsRelativeCurrent:function(t){var e=t;var n=t.id;var i=[];var a;while(e){a=BX.data(e,"relative");if(a===n||a===t.id){n=e.id;i.push(e)}e=e.nextElementSibling}i.forEach(function(t){BX.remove(t)})},validateData:function(t){return"ONCHANGE"in t&&BX.type.isArray(t.ONCHANGE)},activateControl:function(t){var e=BX(t);if(BX.type.isDomNode(e)){BX.removeClass(e,this.parent.settings.get("classDisable"));e.disabled=null}},deactivateControl:function(t){var e=BX(t);if(BX.type.isDomNode(e)){BX.addClass(e,this.parent.settings.get("classDisable"));e.disabled=true}},showControl:function(t){var e=BX(t);if(BX.type.isDomNode(e)){BX.show(e)}},hideControl:function(t){var e=BX(t);if(BX.type.isDomNode(e)){BX.hide(e)}},validateActionObject:function(t){return BX.type.isPlainObject(t)&&"ACTION"in t&&BX.type.isNotEmptyString(t.ACTION)&&"DATA"in t&&BX.type.isArray(t.DATA)},validateControlObject:function(t){return BX.type.isPlainObject(t)&&"TYPE"in t&&"ID"in t},createControl:function(t,e){var n;switch(t.TYPE){case this.types.DROPDOWN:{n=this.createDropdown(t,e);break}case this.types.CHECKBOX:{n=this.createCheckbox(t,e);break}case this.types.TEXT:{n=this.createText(t,e);break}case this.types.HIDDEN:{n=this.createHidden(t,e);break}case this.types.BUTTON:{n=this.createButton(t,e);break}case this.types.LINK:{n=this.createLink(t,e);break}case this.types.CUSTOM:{n=this.createCustom(t,e);break}default:{break}}return n},onChangeHandler:function(container,actions,isPseudo){var newElement,callback;var self=this;if(BX.type.isDomNode(container)&&BX.type.isArray(actions)){actions.forEach(function(action){if(self.validateActionObject(action)){if(action.ACTION===self.actions.CREATE){self.removeItemsRelativeCurrent(container);action.DATA.reverse();action.DATA.forEach(function(t){if(self.validateControlObject(t)){newElement=self.createControl(t,BX.data(container,"relative")||container.id);if(BX.type.isDomNode(newElement)){BX.insertAfter(newElement,container);if("ONCHANGE"in t&&t.TYPE===self.types.CHECKBOX&&"CHECKED"in t&&t.CHECKED){self.onChangeHandler(newElement,t.ONCHANGE)}if(t.TYPE===self.types.DROPDOWN&&BX.type.isArray(t.ITEMS)&&t.ITEMS.length&&"ONCHANGE"in t.ITEMS[0]&&BX.type.isArray(t.ITEMS[0].ONCHANGE)){self.onChangeHandler(newElement,t.ITEMS[0].ONCHANGE)}}}})}if(action.ACTION===self.actions.ACTIVATE){self.removeItemsRelativeCurrent(container);if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){self.lastActivated.push(t.ID);self.activateControl(t.ID)})}}if(action.ACTION===self.actions.SHOW){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){self.showControl(t.ID)})}}if(action.ACTION===self.actions.HIDE){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){self.hideControl(t.ID)})}}if(action.ACTION===self.actions.HIDE_ALL_EXPECT){if(BX.type.isArray(action.DATA)){(self.getControls()||[]).forEach(function(t){if(!action.DATA.some(function(e){return e.ID===t.id})){self.hideControl(t.id)}})}}if(action.ACTION===self.actions.SHOW_ALL){(self.getControls()||[]).forEach(function(t){self.showControl(t.id)})}if(action.ACTION===self.actions.REMOVE){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(t){BX.remove(BX(t.ID))})}}if(action.ACTION===self.actions.CALLBACK){this.confirmDialog(action,BX.delegate(function(){if(BX.type.isArray(action.DATA)){action.DATA.forEach(function(currentCallback){if(currentCallback.JS.indexOf("Grid.")!==-1){callback=currentCallback.JS.replace("Grid","self.parent");callback=callback.replace("()","");callback+=".apply(self.parent, [container])";try{eval(callback)}catch(err){throw new Error(err)}}else if(BX.type.isNotEmptyString(currentCallback.JS)){try{eval(currentCallback.JS)}catch(err){console.log(err)}}})}},this))}}},this)}else{if(!isPseudo){this.removeItemsRelativeCurrent(container)}self.lastActivated.forEach(function(t){self.deactivateControl(t)});self.lastActivated=[]}},confirmDialog:function(t,e,n){var i,a,r,o;var s=this;if("CONFIRM"in t&&t.CONFIRM){t.CONFIRM_MESSAGE=t.CONFIRM_MESSAGE||this.parent.arParams.CONFIRM_MESSAGE;t.CONFIRM_APPLY_BUTTON=t.CONFIRM_APPLY_BUTTON||this.parent.arParams.CONFIRM_APPLY;t.CONFIRM_CANCEL_BUTTON=t.CONFIRM_CANCEL_BUTTON||this.parent.arParams.CONFIRM_CANCEL;i=new BX.PopupWindow(this.parent.getContainerId()+"-confirm-dialog",null,{content:'<div class="main-grid-confirm-content">'+t.CONFIRM_MESSAGE+"</div>",titleBar:"CONFIRM_TITLE"in t?t.CONFIRM_TITLE:"",autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:true,closeByEsc:true,events:{onClose:function(){BX.unbind(window,"keydown",c)}},buttons:[new BX.PopupWindowButton({text:t.CONFIRM_APPLY_BUTTON,id:this.parent.getContainerId()+"-confirm-dialog-apply-button",events:{click:function(){BX.type.isFunction(e)?e():null;this.popupWindow.close();this.popupWindow.destroy();BX.onCustomEvent(window,"Grid::confirmDialogApply",[this]);BX.unbind(window,"keydown",c)}}}),new BX.PopupWindowButtonLink({text:t.CONFIRM_CANCEL_BUTTON,id:this.parent.getContainerId()+"-confirm-dialog-cancel-button",events:{click:function(){BX.type.isFunction(n)?n():null;this.popupWindow.close();this.popupWindow.destroy();BX.onCustomEvent(window,"Grid::confirmDialogCancel",[this]);BX.unbind(window,"keydown",c)}}})]});if(!i.isShown()){i.show();a=i.popupContainer;BX.removeClass(a,this.parent.settings.get("classCloseAnimation"));BX.addClass(a,this.parent.settings.get("classShowAnimation"));r=BX(this.parent.getContainerId()+"-confirm-dialog-apply-button");o=BX(this.parent.getContainerId()+"-confirm-dialog-cancel-button");BX.bind(window,"keydown",c)}}else{BX.type.isFunction(e)?e():null}function c(t){if(t.code==="Enter"){t.preventDefault();t.stopPropagation();BX.fireEvent(r,"click")}if(t.code==="Escape"){t.preventDefault();t.stopPropagation();BX.fireEvent(o,"click")}}},_dropdownChange:function(t,e,n,i){var a=BX(t);var r=a.parentNode;var o=i&&"ONCHANGE"in i?i.ONCHANGE:null;var s="PSEUDO"in i&&i.PSEUDO!=false;this.onChangeHandler(r,o,s)},_checkboxChange:function(event){var onChange;try{onChange=eval(BX.data(event.target,"onchange"))}catch(err){onChange=null}this.onChangeHandler(BX.findParent(event.target,{className:this.parent.settings.get("classPanelContainer")},true,false),event.target.checked||event.target.id.indexOf("actallrows_")!==-1?onChange:null)},_clickOnButton:function(event){var onChange;if(this.isButton(event.target)){event.preventDefault();try{onChange=eval(BX.data(event.target,"onchange"))}catch(err){onChange=null}this.onChangeHandler(BX.findParent(event.target,{className:this.parent.settings.get("classPanelContainer")},true,false),onChange)}},isButton:function(t){return BX.hasClass(t,this.parent.settings.get("classPanelButton"))},getSelectedIds:function(){var t=this.parent.getRows().getSelected();return t.map(function(t){return t.getId()})},getRequestData:function(){return{panel:this.getValues(),selectedRows:this.getSelectedIds()}},getControls:function(){return BX.findChild(this.getPanel(),{className:this.parent.settings.get("classPanelControlContainer")},true,true)},getValues:function(){var t={};var e=this;var n=[].concat(this.getDropdowns(),this.getTextInputs(),this.getHiddenInputs(),this.getCheckboxes());(n||[]).forEach(function(n){if(BX.type.isDomNode(n)){if(e.isDropdown(n)){t[BX.data(n,"name")]=BX.data(n,"value")}if(e.isCheckbox(n)&&n.checked){t[n.getAttribute("name")]=n.value}if(e.isTextInput(n)||e.isHiddenInput(n)){t[n.getAttribute("name")]=n.value}}});return t}}})();
//# sourceMappingURL=action-panel.map.js