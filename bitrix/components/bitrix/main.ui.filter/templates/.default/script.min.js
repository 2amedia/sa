(function(){"use strict";BX.namespace("BX.Main");BX.Main.Filter=function(t,e,s,i,a){this.params=null;this.search=null;this.popup=null;this.presets=null;this.fields=null;this.types=null;this.dateTypes=null;this.settings=null;this.filter=null;this.api=null;this.isAddPresetModeState=false;this.init(t,e,s,i,a)};BX.Main.Filter.prototype={init:function(t,e,s,i,a){try{this.params=t;this.types=s;this.dateTypes=i;this.numberTypes=a;this.settings=new BX.Filter.Settings(e,this);BX.bind(document,"mousedown",BX.delegate(this._onDocumentClick,this));BX.bind(this.getSearch().getContainer(),"click",BX.delegate(this._onSearchContainerClick,this));if(this.getParam("GRID_ID")){BX.addCustomEvent("Grid::ready",BX.delegate(this._onGridReady,this))}}catch(r){throw r}BX.bind(document,"keydown",BX.delegate(this._onDocumentKeydown,this));this.getPopup();this.getSearch().updatePreset(this.getPreset().getCurrentPresetData());this.getPreset().applyPreset(this.getPreset().getCurrentPresetId());if(this.getParam("CLEAR_GET")){this.clearGet()}BX.bind(window,"load",BX.delegate(function(){this.adjustFocus()},this));this.firstInit=true},clearGet:function(){if("history"in window){var t=window.location.toString();var e=BX.util.remove_url_param(t,"apply_filter");window.history.replaceState(null,"",e)}},adjustFocus:function(){var t=this.getSearch().getInput();if(BX.type.isDomNode(t)){if(window.scrollY<BX.pos(t).top){t.value=t.value;t.blur();t.focus()}}},_onAddPresetKeydown:function(t){if(t.code==="Enter"){this._onSaveButtonClick()}},_onDocumentKeydown:function(t){if(t.code==="Escape"||t.keyCode==27){if(this.getPopup().isShown()){this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}}}},getApi:function(){if(!(this.api instanceof BX.Filter.Api)){this.api=new BX.Filter.Api(this)}return this.api},addSidebarItem:function(t,e,s){var i=this.getPreset();var a=BX.decl({block:"sidebar-item",text:e,id:t,pinned:s,noEditPinTitle:this.getParam("MAIN_UI_FILTER__IS_SET_AS_DEFAULT_PRESET"),editNameTitle:this.getParam("MAIN_UI_FILTER__EDIT_PRESET_TITLE"),removeTitle:this.getParam("MAIN_UI_FILTER__REMOVE_PRESET"),editPinTitle:this.getParam("MAIN_UI_FILTER__SET_AS_DEFAULT_PRESET"),dragTitle:this.getParam("MAIN_UI_FILTER__DRAG_TITLE")});var r=i.getContainer();var n=i.getPresetNodeById(t);if(BX.type.isDomNode(n)){BX.insertAfter(a,n);BX.remove(n)}else{r.insertBefore(a,this.getPreset().getAddPresetField())}BX.bind(a,"click",BX.delegate(i._onPresetClick,this.getPreset()))},saveUserSettings:function(t){var e={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER_ARRAY"};var s=this.getPreset();var i=s.getCurrentPresetId();var a={};this.params["PRESETS"]=BX.clone(this.editablePresets);a.current_preset=i;s.getPresets().forEach(function(t,e){var i=s.getPresetId(t);if(i&&i!=="tmp_filter"){var r=s.getPreset(i);var n=r.FIELDS.map(function(t){return t.NAME});r.TITLE=BX.util.htmlspecialchars(r.TITLE);r.SORT=e;s.updatePresetName(t,r.TITLE);a[i]={sort:e,name:r.TITLE,fields:this.preparePresetSettingsFields(r.FIELDS,n)}}},this);this.saveOptions(a,e,null,t)},isForAll:function(){var t=this.getForAllCheckbox();return t&&t.checked},getForAllCheckbox:function(){if(!this.forAllCheckbox){this.forAllCheckbox=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllCheckbox)}return this.forAllCheckbox},preparePresetSettingsFields:function(t){var e={};var s;(t||[]).forEach(function(t){switch(t.TYPE){case this.types.STRING:{e[t.NAME]=t.VALUE;break}case this.types.SELECT:{e[t.NAME]="VALUE"in t.VALUE?t.VALUE.VALUE:"";break}case this.types.MULTI_SELECT:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){t.VALUE.forEach(function(s,i){e[t.NAME]=BX.type.isPlainObject(e[t.NAME])?e[t.NAME]:{};e[t.NAME][i]=s.VALUE},this)}break}case this.types.CHECKBOX:{if(BX.type.isArray(t.VALUE)&&t.VALUE.length){t.VALUE.forEach(function(s,i){e[t.NAME]=BX.type.isPlainObject(e[t.NAME])?e[t.NAME]:{};e[t.NAME][i]=s.VALUE},this)}break}case this.types.DATE:{if(BX.type.isPlainObject(t.VALUES)){s=Object.keys(t.VALUES);e[t.NAME+"_datesel"]=t.SUB_TYPE.VALUE;s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]},this)}break}case this.types.NUMBER:{if(BX.type.isPlainObject(t.VALUES)){s=Object.keys(t.VALUES);e[t.NAME+"_numsel"]=t.SUB_TYPE.VALUE;s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]},this)}break}case this.types.CUSTOM_ENTITY:{if(BX.type.isPlainObject(t.VALUES)){e[t.NAME]=t.VALUES._value;e[t.NAME+"_label"]=t.VALUES._label}break}default:{break}}},this);return e},savePreset:function(){var t="filter_"+ +new Date;var e=this.getPreset().getAddPresetFieldInput().value;e=BX.util.htmlspecialchars(e);this.updatePreset(t,e,null,true);this.addSidebarItem(t,e);this.getPreset().applyPreset(t);this.getPreset().activatePreset(t);this.applyFilter()},updatePreset:function(t,e,s,i,a,r){var n=this.getFilterFieldsValues();var l=this.getPreset().getFields().map(function(t){return BX.data(t,"name")});var o=this.getPreset().getCurrentPresetData();var h={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var d,u,c,g,f;var p={};d=Object.keys(n);if(!s){p.apply_filter="Y"}else{p.clear_filter="Y"}p.save="Y";p.fields=n;p.rows=l.join(",");p.preset_id=t||o.ID;if(BX.type.isNotEmptyString(e)){p.name=BX.util.htmlspecialchars(e)}else{c=this.getPreset().getPresetNodeById(p.preset_id);g=this.getPreset().getPresetInput(c);if(BX.type.isDomNode(g)&&BX.type.isNotEmptyString(g.value)){p.name=g.value}else{p.name=o.TITLE}}if((!("sort"in p)||!BX.type.isNumber(p.sort))&&i){f=this.getParam("PRESETS");p.sort=f.length+2}if(!s){d.forEach(function(t){if(BX.type.isArray(p.fields[t])){u=p.fields[t].length?{}:"";p.fields[t].forEach(function(t,e){u[e]=t},this);if(u||BX.type.isNumber(u)||BX.type.isBoolean(u)){p.fields[t]=u}}},this)}if(p.preset_id==="tmp_filter"||this.isAddPresetEnabled()||s){this.updateParams(p)}if(BX.type.isFunction(a)){a()}this.saveOptions(p,h,r)},saveFieldsSort:function(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var e=this.getPreset().getFields();var s={};s.preset_id="default_filter";if(BX.type.isArray(e)){s.rows=e.map(function(t){return BX.data(t,"name")});s.rows=s.rows.join(",")}this.updateParams(s);this.saveOptions(s,t)},updateParams:function(t){var e,s;var i=[];if(BX.type.isPlainObject(t)&&"preset_id"in t){e=this.getPreset().getPreset(t.preset_id);if(BX.type.isPlainObject(e)){if("name"in t&&BX.type.isNotEmptyString(t.name)){e.TITLE=t.name}if("rows"in t&&!("fields"in t)){t.fields={};t.rows.split(",").forEach(function(e){t.fields[e]=""})}if("fields"in t){e.FIELDS=this.preparePresetFields(t.fields,t.rows)}}else{s=this.getParam("PRESETS");e={ID:t.preset_id,TITLE:t.name,SORT:s.length+2,FIELDS:this.preparePresetFields(t.fields,t.rows)};s.push(e)}}},preparePresetFields:function(t,e){var s,i;var a=[];if(BX.type.isPlainObject(t)){e=BX.type.isNotEmptyString(e)?e.split(","):[];s=e.length?e:Object.keys(t);s.forEach(function(e){e=e.replace("_datesel","").replace("_numsel","");i=BX.clone(this.getFieldByName(e));if(BX.type.isPlainObject(i)){if(i.TYPE===this.types.STRING){i.VALUE=t[e]}if(i.TYPE===this.types.MULTI_SELECT){i.VALUE=this.prepareMultiSelectValue(t[e],i.ITEMS)}if(i.TYPE===this.types.SELECT||i.TYPE===this.types.CHECKBOX){i.VALUE=this.prepareSelectValue(t[e],i.ITEMS)}if(i.TYPE===this.types.DATE){i.SUB_TYPE=this.prepareSelectValue(t[e+"_datesel"],i.SUB_TYPES);i.VALUES={_from:t[e+"_from"],_to:t[e+"_to"],_days:t[e+"_days"],_month:t[e+"_days"],_quarter:t[e+"_quarter"],_year:t[e+"_year"]}}if(i.TYPE===this.types.NUMBER){i.SUB_TYPE=this.prepareSelectValue(t[e+"_numsel"],i.SUB_TYPES);i.VALUES={_from:t[e+"_from"],_to:t[e+"_to"]}}if(i.TYPE===this.types.CUSTOM_ENTITY){i.VALUES._label=t[e+"_label"];i.VALUES._value=t[e]}if(i.TYPE===this.types.CUSTOM){i._VALUE=t[e]}a.push(i)}},this)}return a},prepareSelectValue:function(t,e){var s={};var i;if(BX.type.isNotEmptyString(t)&&BX.type.isArray(e)){i=this.prepareMultiSelectValue({0:t},e);s=i.length>0?i[0]:{}}else{s=e[0]}return s},prepareMultiSelectValue:function(t,e){var s=[];if(BX.type.isPlainObject(t)&&BX.type.isArray(e)){var i=Object.keys(t);var a=i.map(function(e){return t[e]});s=e.filter(function(t){return a.some(function(e){return e===t.VALUE})},this)}return s},getFieldByName:function(t){var e=this.getParam("FIELDS");e=e.filter(function(e){return e.NAME===t},this);return e.length>0?e[0]:null},saveOptions:function(t,e,s,i){var a=BX.util.add_url_param(this.getParam("SETTINGS_URL"),e||{});if(i&&("action"in e&&e.action==="SET_FILTER_ARRAY")){var r={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("MAIN_UI_FILTER__CONFIRM_MESSAGE_FOR_ALL"),CONFIRM_APPLY_BUTTON:this.getParam("MAIN_UI_FILTER__CONFIRM_APPLY_FOR_ALL"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(r,BX.delegate(function(){a=BX.util.add_url_param(a,{for_all:"true"});this.disableEdit();this.disableAddPreset();n(a,this,true)},this),BX.delegate(function(){BX.removeClass(this.getSaveForAllButton(),this.settings.classWaitButtonClass)},this))}else{n(a,this)}function n(e,i,a){BX.ajax.post(e,t,BX.delegate(function(){BX.removeClass(this.getFindButton(),this.settings.classWaitButtonClass);a&&BX.removeClass(this.getSaveForAllButton(),this.settings.classWaitButtonClass);BX.type.isFunction(s)&&s()},i))}},prepareEvent:function(t){var e,s;if(!("path"in t)||!t.path.length){t.path=[t.target];e=0;while((s=t.path[e++].parentNode)!=null){t.path.push(s)}}return t},restoreRemovedPreset:function(){if(this.getParam("VALUE_REQUIRED_MODE")){var t=this.getParam("CURRENT_PRESET");if(BX.type.isPlainObject(t)){var e=t.ID;var s=this.getPreset().getPresetNodeById(e);this.getPreset().applyPreset(e);this.getPreset().activatePreset(s)}}},hasScrollClick:function(t){var e="screenX"in t?t.screenX:"x"in t?t.x:0;return e>=document.documentElement.offsetWidth},_onDocumentClick:function(t){var e,s,i;var a=this.getPopup();var r=this.getFieldsPopup();if(a&&a.isShown()){t=this.prepareEvent(t);e=(t.path||[]).some(function(t){s=false;if(BX.type.isDomNode(t)){s=BX.hasClass(t,this.settings.classFilterContainer)||BX.hasClass(t,this.settings.classSearchContainer)||BX.hasClass(t,this.settings.classDefaultPopup)||BX.hasClass(t,this.settings.classPopupOverlay)}return s},this);if(!e&&!this.hasScrollClick(t)){this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}}}if(r&&r.isShown()){i=(t.path||[]).some(function(t){s=false;if(BX.type.isDomNode(t)){s=BX.hasClass(t,this.settings.classFieldListItem)||BX.hasClass(t,this.settings.classPopupFieldList)}return s},this);if(!i&&!BX.hasClass(t.target,this.settings.classAddField)&&!this.hasScrollClick(t)){this.closeFieldListPopup()}}},_onAddFieldClick:function(t){var e=this.getFieldsPopup();t.stopPropagation();t.preventDefault();if(e&&!e.isShown()){this.showFieldsPopup();this.syncFields()}else{this.closeFieldListPopup()}},syncFields:function(){var t=this.getPreset().getFields();var e=this.getFieldsPopupItems();var s,i;if(BX.type.isArray(e)&&e.length){e.forEach(function(e){s=BX.data(e,"name").replace("_datesel","").replace("_numsel","");i=t.some(function(t){return BX.data(t,"name")===s});if(i){BX.addClass(e,this.settings.classMenuItemChecked)}else{BX.removeClass(e,this.settings.classMenuItemChecked)}},this)}},getFieldsPopupItems:function(){var t;if(!BX.type.isArray(this.fieldsPopupItems)){t=this.getFieldsPopup();if("contentContainer"in t&&BX.type.isDomNode(t.contentContainer)){this.fieldsPopupItems=BX.Filter.Utils.getByClass(t.contentContainer,this.settings.classMenuItem,true)}}return this.fieldsPopupItems},getFieldListPopupItems:function(){var t,e;var s=this.getParam("FIELDS");var i=BX.create("div",{props:{className:this.settings.classPopupFieldList}});if(BX.type.isArray(s)&&s.length){if(s.length<6){BX.addClass(i,this.settings.classPopupFieldList1Column)}if(s.length>6&&s.length<12){BX.addClass(i,this.settings.classPopupFieldList2Column)}if(s.length>12){BX.addClass(i,this.settings.classPopupFieldList3Column)}s.forEach(function(s){e=BX.create("div",{props:{className:[this.settings.classMenuItem,this.settings.classFieldListItem].join(" ")},attrs:{"data-id":s.ID,"data-name":s.NAME,"data-item":JSON.stringify(s)}});t=BX.create("div",{props:{className:this.settings.classMenuMultiItemText},text:s.LABEL});BX.append(t,e);BX.append(e,i);BX.bind(e,"click",BX.delegate(this._clickOnFieldListItem,this))},this)}return i},_clickOnFieldListItem:function(t){var e=t.target;var s;if(!BX.hasClass(e,this.settings.classFieldListItem)){e=BX.findParent(e,{"class":this.settings.classFieldListItem},true,false)}if(BX.type.isDomNode(e)){try{s=JSON.parse(BX.data(e,"item"))}catch(i){}if(BX.hasClass(e,this.settings.classMenuItemChecked)){BX.removeClass(e,this.settings.classMenuItemChecked);this.getPreset().removeField(s)}else{if(BX.type.isPlainObject(s)){this.getPreset().addField(s);BX.addClass(e,this.settings.classMenuItemChecked)}}this.syncFields()}},showFieldsPopup:function(){var t=this.getFieldsPopup();this.adjustFieldListPopupPosition();t.show()},closeFieldListPopup:function(){var t=this.getFieldsPopup();t.close()},adjustFieldListPopupPosition:function(){var t=this.getFieldsPopup();var e=BX.pos(this.getAddField());e.forceBindPosition=true;t.adjustPosition(e)},getFieldsPopup:function(){var t=this.getAddField();if(!this.fieldsPopup){this.fieldsPopup=new BX.PopupWindow(this.getParam("FILTER_ID")+"_fields_popup",t,{autoHide:false,offsetTop:4,offsetLeft:0,lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:13});this.fieldsPopup.setContent(this.getFieldListPopupItems())}return this.fieldsPopup},_onAddPresetClick:function(){this.enableAddPreset()},_onSaveButtonClick:function(){BX.addClass(this.getFindButton(),this.settings.classWaitButtonClass);if(this.isAddPresetEnabled()){this.savePreset();this.disableAddPreset()}if(this.isEditEnabled()){this.getPreset().updateEditablePreset(this.getPreset().getCurrentPresetId());this.saveUserSettings();this.disableEdit();if(this.isAddPresetEnabled()){this.savePreset();this.disableAddPreset()}}this.getPreset().getDefaultPresets().forEach(function(t){t.style=null},this)},_onCancelButtonClick:function(){this.disableAddPreset();this.getPreset().getAddPresetFieldInput().value="";this.disableEdit();this.getPreset().getDefaultPresets().forEach(function(t){t.style=null},this)},_onSaveForAllButtonClick:function(){BX.addClass(this.getSaveForAllButton(),this.settings.classWaitButtonClass);this.saveUserSettings(true)},_onGridReady:function(t){if(!this.grid&&t.getContainerId()===this.getParam("GRID_ID")){this.grid=t}},_onFilterClick:function(t){var e,s,i,a,r,n;var l=this.getFields();var o=this.getPreset();var h=t.target;if(l.isFieldDelete(h)){r=l.getField(h);o.removeField(r)}if(BX.hasClass(h,this.settings.classValueDelete)||BX.hasClass(h.parentNode,this.settings.classValueDelete)){r=l.getField(h);if(BX.type.isDomNode(r)){a=BX.Filter.Utils.getByClass(r,this.settings.classControl,true);i=BX.Filter.Utils.getByClass(r,this.settings.classSquare,true);if(BX.type.isArray(i)){i.forEach(function(t){BX.remove(t)})}if(BX.type.isArray(a)){for(e=0,s=a.length;e<s;e++){n=a[e];if(BX.type.isDomNode(n)&&n.tagName==="INPUT"&&(n.type==="text"||n.type==="hidden")){n.value=""}}}}}},getButtonsContainer:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classButtonsContainer)},getSaveButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSaveButton)},getCancelButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classCancelButton)},getFindButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFindButton)},getResetButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classResetButton)},getAddPresetButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddPresetButton)},isAddPresetEnabled:function(){return this.isAddPresetModeState},enableAddPreset:function(){var t=this.getPreset();var e=t.getAddPresetField();var s=t.getAddPresetFieldInput();var i=this.getButtonsContainer();BX.show(e);BX.show(i);BX.hide(this.getPresetButtonsContainer());this.getSaveForAllButton()&&BX.hide(this.getSaveForAllButton());if(BX.type.isDomNode(s)){s.focus()}BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=true},disableAddPreset:function(){var t=this.getPreset();var e=t.getAddPresetField();var s=this.getButtonsContainer();var i=t.getCurrentPresetId();BX.hide(e);BX.hide(s);BX.show(this.getPresetButtonsContainer());this.getSaveForAllButton()&&BX.show(this.getSaveForAllButton());if(BX.type.isNotEmptyString(i)){t.applyPreset(i)}t.getAddPresetFieldInput().value="";BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.isAddPresetModeState=false},getControls:function(){var t=this.getFieldListContainer();var e=null;if(BX.type.isDomNode(t)){e=BX.Filter.Utils.getByClass(t,this.settings.classControl,true)}return e},getFilterFields:function(){var t=this.getFieldListContainer();var e=[];var s=[];if(BX.type.isDomNode(t)){e=BX.Filter.Utils.getByClass(t,this.settings.classField,true);s=BX.Filter.Utils.getByClass(t,this.settings.classFieldGroup,true);if(!BX.type.isArray(e)){e=[]}if(BX.type.isArray(s)){s.forEach(function(t){e.push(t)})}}return e},getFilterFieldsValues:function(){var t=this.getPreset().getFields();var e=this.getSearch();var s={};var i,a;s["FIND"]=e.getInput().value;if(BX.type.isArray(t)&&t.length){t.forEach(function(t){i=BX.data(t,"type");a=BX.data(t,"name");switch(i){case this.types.STRING:{this.prepareControlStringValue(s,t);break}case this.types.NUMBER:{this.prepareControlNumberValue(s,a,t);break}case this.types.DATE:{this.prepareControlDateValue(s,a,t);break}case this.types.SELECT:{this.prepareControlSelectValue(s,a,t);break}case this.types.MULTI_SELECT:{this.prepareControlMultiselectValue(s,a,t);break}case this.types.CUSTOM:{this.prepareControlCustomValue(s,a,t);break}case this.types.CUSTOM_ENTITY:{this.prepareControlCustomEntityValue(s,a,t);break}default:{break}}},this)}return s},prepareControlCustomEntityValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classSquare);var a;t[e]="";t[e+"_label"]="";if(BX.type.isDomNode(i)){try{a=JSON.parse(BX.data(i,"item"));if(BX.type.isPlainObject(a)){t[e]=a._value;t[e+"_label"]=a._label}}catch(r){}}},prepareControlCustomValue:function(t,e,s){var i=BX.Filter.Utils.getByTag(s,"input",true);t[e]="";if(BX.type.isArray(i)){i.forEach(function(e){if(BX.type.isNotEmptyString(e.name)){t[e.name]=e.value}})}},prepareControlMultiselectValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classMultiSelect);var a=JSON.parse(BX.data(i,"value"));t[e]="";if(BX.type.isArray(a)&&a.length){t[e]={};a.forEach(function(s,i){t[e][i]=s.VALUE})}},prepareControlSelectValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var a=JSON.parse(BX.data(i,"value"));t[e]=a.VALUE},prepareControlDateValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var a=e+this.settings.datePostfix;var r=e+this.settings.fromPostfix;var n=e+this.settings.toPostfix;var l=e+this.settings.daysPostfix;var o=e+this.settings.monthPostfix;var h=e+this.settings.quarterPostfix;var d=e+this.settings.yearPostfix;var u,c,g,f;t[a]="";t[r]="";t[n]="";t[l]="";t[o]="";t[h]="";t[d]="";u=JSON.parse(BX.data(i,"value"));t[a]=u.VALUE;switch(u.VALUE){case this.dateTypes.EXACT:{c=BX.Filter.Utils.getByClass(s,this.settings.classDateInput);t[r]=c.value;t[n]=c.value;break}case this.dateTypes.QUARTER:{g=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(g)){g.forEach(function(e){f=BX.data(e,"name");if(f&&f.indexOf("_quarter")!==-1){t[h]=JSON.parse(BX.data(e,"value")).VALUE}if(f&&f.indexOf("_year")!==-1){t[d]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.YEAR:{g=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(g)){g.forEach(function(e){f=BX.data(e,"name");if(f&&f.indexOf("_year")!==-1){t[d]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.MONTH:{g=BX.Filter.Utils.getByClass(s,this.settings.classControl,true);if(BX.type.isArray(g)){g.forEach(function(e){f=BX.data(e,"name");if(f&&f.indexOf("_month")!==-1){t[o]=JSON.parse(BX.data(e,"value")).VALUE}if(f&&f.indexOf("_year")!==-1){t[d]=JSON.parse(BX.data(e,"value")).VALUE}},this)}break}case this.dateTypes.RANGE:{c=BX.Filter.Utils.getByClass(s,this.settings.classDateInput,true);c.forEach(function(e){if(e.name===r){t[r]=e.value}else if(e.name===n){t[n]=e.value}},this);break}default:{break}}},prepareControlNumberValue:function(t,e,s){var i=BX.Filter.Utils.getByClass(s,this.settings.classNumberInput,true);var a=BX.Filter.Utils.getByClass(s,this.settings.classSelect);var r=e+this.settings.numberPostfix;var n=e+this.settings.fromPostfix;var l=e+this.settings.toPostfix;var o;t[n]="";t[l]="";o=JSON.parse(BX.data(a,"value"));t[r]=o.VALUE;i.forEach(function(e){if(e.name.indexOf(this.settings.fromPostfix)!==-1){t[n]=e.value||"";if(t[r]==="exact"){t[l]=e.value||""}}else if(e.name.indexOf(this.settings.toPostfix)!==-1){t[l]=e.value||""}},this)},prepareControlStringValue:function(t,e){var s=BX.Filter.Utils.getByClass(e,this.settings.classStringInput);var i;if(BX.type.isDomNode(s)){i=s.name;t[i]=s.value}},applyFilter:function(t,e){var s=this.getFilterFieldsValues();var i=this.getParam("FILTER_ID");var a=this.getPreset().getCurrentPresetId();var r=t?"clear_filter":"apply_filter";var n;if(!this.isEditEnabled()&&!this.isAddPresetEnabled()&&!e||a==="default_filter"&&!t){a="tmp_filter"}s[r]="Y";s.save="Y";s.preset_id=a;s.ajax_request="Y";if(this.grid){this.grid.tableFade()}this.updatePreset(a,null,t,null,BX.delegate(function(){this.getSearch().updatePreset(this.getPreset().getPreset(a))},this),BX.delegate(function(){n=Object.keys(s);n.forEach(function(t){if(t.indexOf("_label")!==-1){delete s[t]}});s["FIND"]=BX.util.htmlspecialchars(this.getSearch().getInput().value);if(this.grid){this.grid.reloadTable("POST",{apply_filter:"Y",clear_nav:"Y"})}BX.onCustomEvent(window,"BX.Main.Filter:apply",[i,s,this])},this))},getAddField:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classAddField)},getFieldListContainer:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classFileldControlList)},getFields:function(){if(!(this.fields instanceof BX.Filter.Fields)){this.fields=new BX.Filter.Fields(this)}return this.fields},getPreset:function(){if(!(this.presets instanceof BX.Filter.Presets)){this.presets=new BX.Filter.Presets(this)}return this.presets},resetControlData:function(t){if(BX.type.isPlainObject(t)){switch(t.TYPE){case this.types.MULTI_SELECT:{t.VALUE=[];break}case this.types.SELECT:{t.VALUE=t.ITEMS[0];break}case this.types.DATE:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:"",_days:"",_quarter:"",_year:""};break}case this.types.NUMBER:{t.SUB_TYPE=t.SUB_TYPES[0];t.VALUES={_from:"",_to:""};break}case this.types.CUSTOM_ENTITY:{t.VALUES={_label:"",_value:""};break}case this.types.CUSTOM:{t._VALUE="";break}default:{t.VALUE=""}}}return t},clearControl:function(t){var e=this.getPreset().getField({NAME:t});var s,i;if(BX.type.isDomNode(e)){s=this.getFieldByName(t);s=this.resetControlData(s);i=this.getPreset().createControl(s);BX.insertAfter(i,e);BX.remove(e)}},_onSearchContainerClick:function(t){var e=this.getSearch();var s,i,a,r,n,l;if(!BX.hasClass(t.target,this.settings.classSquareDelete)&&!BX.hasClass(t.target,this.settings.classClearSearchValueButton)&&!BX.hasClass(t.target,this.settings.classSearchButton)){if(!this.getPopup().isShown()){this.showPopup()}else{this.closePopup();if(this.getParam("VALUE_REQUIRED_MODE")){this.restoreRemovedPreset()}}}else{if(BX.hasClass(t.target,this.settings.classSquareDelete)){a=BX.findParent(t.target,{className:this.settings.classSquare},true,false);r=false;try{n=JSON.parse(BX.data(a,"item"));r=n.type==="control"||BX.type.isArray(n)&&n.length}catch(o){}if(!r){if(!this.getParam("VALUE_REQUIRED_MODE")){this.resetFilter(true)}else{if(a){BX.remove(a);this.getPreset().deactivateAllPresets()}}}else{if(BX.type.isArray(n)&&n.length){n.forEach(function(t){this.clearControl(t.name)},this)}else{this.clearControl(n.name)}BX.remove(a);l=BX.Filter.Utils.getByClass(this.getSearch().getContainer(),this.settings.classSquare,true);if(!this.getParam("VALUE_REQUIRED_MODE")){if(!l.length){this.resetFilter(true)}else{this.applyFilter()}}}e.getInput().focus();l=BX.Filter.Utils.getByClass(this.getSearch().getContainer(),this.settings.classSquare,true);if(!l.length&&!e.getInput().value.length){e.hideClearButton();if(this.getParam("DISABLE_SEARCH")){this.getSearch().setInputPlaceholder(this.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.getSearch().setInputPlaceholder(this.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}}if(this.getPopup().isShown()&&!this.getParam("VALUE_REQUIRED_MODE")){this.closePopup()}if(this.getParam("VALUE_REQUIRED_MODE")){this.showPopup()}}if(BX.hasClass(t.target,this.settings.classClearSearchValueButton)){s=e.getPreset();i=e.getInput().value;e.clearForm();e.getInput().focus();this.getPreset().deactivateAllPresets();this.getPreset().resetPreset();if(!this.getParam("VALUE_REQUIRED_MODE")){this.resetFilter()}else{var l=BX.Filter.Utils.getByClass(this.getSearch().getContainer(),this.settings.classSquare,true);if(BX.type.isArray(l)){l.forEach(BX.remove)}}if(this.getPopup().isShown()&&!this.getParam("VALUE_REQUIRED_MODE")){this.closePopup()}if(this.getParam("VALUE_REQUIRED_MODE")){this.showPopup()}if(this.getParam("DISABLE_SEARCH")){this.getSearch().setInputPlaceholder(this.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.getSearch().setInputPlaceholder(this.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}e.hideClearButton()}if(BX.hasClass(t.target,this.settings.classSearchButton)){s=e.getPreset();i=e.getInput().value;if(!s||!i){e.getInput().focus()}if(this.getPopup().isShown()){this.closePopup()}}}},getTemplate:function(){return BX.html(BX(this.settings.generalTemplateId))},closePopup:function(){var t=this.getPopup();var e=t.popupContainer;var s;if(!BX.hasClass(document.documentElement,"bx-ie")){BX.removeClass(e,this.settings.classAnimationShow);BX.addClass(e,this.settings.classAnimationClose);s=parseFloat(BX.style(e,"animation-duration"));if(BX.type.isNumber(s)){s=s*1e3}setTimeout(function(){t.close()},s)}else{t.close()}this.closeFieldListPopup();this.adjustFocus()},showPopup:function(){var t=this.getPopup();var e;if(!t.isShown()){t.show();if(!BX.hasClass(document.documentElement,"bx-ie")){e=t.popupContainer;BX.removeClass(e,this.settings.classAnimationClose);BX.addClass(e,this.settings.classAnimationShow)}}},getSaveForAllButton:function(){if(!this.saveForAllButton){this.saveForAllButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classForAllButton)}return this.saveForAllButton},getPopup:function(){if(!(this.popup instanceof BX.PopupWindow)){this.popup=new BX.PopupWindow(this.getParam("FILTER_ID")+this.settings.searchContainerPostfix,this.getSearch().getContainer(),{autoHide:false,offsetTop:4,offsetLeft:0,lightShadow:true,closeIcon:false,closeByEsc:false,noAllPaddings:true,zIndex:12});this.popup.setContent(this.getTemplate());BX.bind(this.getFieldListContainer(),"keydown",BX.delegate(this._onFieldsContainerKeydown,this));BX.bind(this.getFilter(),"click",BX.delegate(this._onFilterClick,this));BX.bind(this.getAddPresetButton(),"click",BX.delegate(this._onAddPresetClick,this));BX.bind(this.getPreset().getAddPresetFieldInput(),"keydown",BX.delegate(this._onAddPresetKeydown,this));BX.bind(this.getPreset().getContainer(),"keydown",BX.delegate(this._onPresetInputKeydown,this));BX.bind(this.getSaveButton(),"click",BX.delegate(this._onSaveButtonClick,this));if(this.getSaveForAllButton()){BX.bind(this.getSaveForAllButton(),"click",BX.delegate(this._onSaveForAllButtonClick,this))}BX.bind(this.getCancelButton(),"click",BX.delegate(this._onCancelButtonClick,this));BX.bind(this.getFindButton(),"click",BX.delegate(this._onFindButtonClick,this));BX.bind(this.getResetButton(),"click",BX.delegate(this._onResetButtonClick,this));BX.bind(this.getAddField(),"click",BX.delegate(this._onAddFieldClick,this));BX.bind(this.getEditButton(),"click",BX.delegate(this._onEditButtonClick,this));BX.bind(this.getRestoreButton(),"click",BX.delegate(this._onRestoreButtonClick,this));BX.bind(this.getRestoreFieldsButton(),"click",BX.delegate(this._onRestoreFieldsButtonClick,this));this.getPreset().showCurrentPresetFields();this.getPreset().bindOnPresetClick()}return this.popup},_onRestoreFieldsButtonClick:function(){this.restoreDefaultFields()},restoreDefaultFields:function(){var t=this.getPreset().getPreset("default_filter",true);var e=this.getParam("PRESETS");var s=this.getPreset().getCurrentPresetId();var i={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"SET_FILTER"};var a=t.FIELDS.map(function(t){return t.NAME});var r=a.join(",");e.forEach(function(s,i){if(s.ID==="default_filter"){e[i]=BX.clone(t)}},this);if(BX.type.isArray(this.editablePresets)){this.editablePresets.forEach(function(e,s){if(e.ID==="default_filter"){this.editablePresets[s]=BX.clone(t)}},this)}this.getPreset().applyPreset(s);this.updatePreset(s);this.saveOptions({preset_id:"default_filter",rows:r,save:"Y",apply_filter:"N"},i)},getRestoreFieldsButton:function(){if(!this.restoreFieldsButton){this.restoreFieldsButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreFieldsButton)}return this.restoreFieldsButton},restoreFilter:function(){var t=this.getParam("DEFAULT_PRESETS");var e=this.getParam("PRESETS");var s=false;var i,a,r;if(BX.type.isArray(t)){t.forEach(function(t){s=e.some(function(e,s){if(e.ID===t.ID){i=s;return true}});if(s){e[i]=BX.clone(t)}else{e.push(BX.clone(t))}if(t.ID!=="default_filter"){this.addSidebarItem(t.ID,t.TITLE,t.PINNED);if(t.PINNED){a=t.ID}}},this)}this.saveRestoreFilter();this.disableAddPreset();this.disableEdit();if(!a){a="default_filter"}r=this.getPreset().getPresetNodeById(a);if(r){BX.fireEvent(r,"click")}},saveRestoreFilter:function(){var t={FILTER_ID:this.getParam("FILTER_ID"),GRID_ID:this.getParam("GRID_ID"),action:"RESTORE_FILTER"};var e=this.getParam("PRESETS");var s={};var i;if(BX.type.isArray(e)){e.forEach(function(t,e){i=t.FIELDS.map(function(t){return t.NAME});i=i.join(",");s[t.ID]={name:t.TITLE||null,sort:e,preset_id:t.ID,fields:this.prepareFields(t.FIELDS),rows:i}},this);this.saveOptions(s,t)}},prepareFields:function(t){var e={};var s;if(BX.type.isArray(t)){t.forEach(function(t){if(t.TYPE===this.types.SELECT){e[t.NAME]="VALUE"in t.VALUE?t.VALUE.VALUE:""}if(t.TYPE===this.types.MULTI_SELECT){t.VALUE.forEach(function(s,i){e[t.NAME]=e[t.NAME]||{};e[t.NAME][i]=s.VALUE});e[t.NAME]=e[t.NAME]||""}if(t.TYPE===this.types.DATE||t.TYPE===this.types.NUMBER){s=Object.keys(t.VALUES);s.forEach(function(s){e[t.NAME+s]=t.VALUES[s]});if(t.TYPE===this.types.DATE){e[t.NAME+"_datesel"]="VALUE"in t.SUB_TYPE?t.SUB_TYPE.VALUE:t.SUB_TYPES[0].VALUE}if(t.TYPE===this.types.NUMBER){e[t.NAME+"_numsel"]="VALUE"in t.SUB_TYPE?t.SUB_TYPE.VALUE:t.SUB_TYPES[0].VALUE}}if(t.TYPE===this.types.CUSTOM_ENTITY){e[t.NAME+"_label"]=t.VALUES._label;e[t.NAME+"_value"]=t.VALUES._value}},this)}return e},getRestoreButton:function(){if(!BX.type.isDomNode(this.restoreButton)){this.restoreButton=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classRestoreButton)}return this.restoreButton},_onPresetInputKeydown:function(t){if(t.code==="Enter"&&t.target.tagName==="INPUT"){BX.fireEvent(this.getSaveButton(),"click")}},_onFieldsContainerKeydown:function(t){if(t.code==="Enter"&&t.target.tagName==="INPUT"){this.applyFilter();this.closePopup()}},_onFindButtonClick:function(){this.getPreset().deactivateAllPresets();this.applyFilter();this.closePopup()},_onResetButtonClick:function(){this.resetFilter();this.getSearch().getInput().value="";this.getSearch().hideClearButton();if(this.getParam("DISABLE_SEARCH")){
this.getSearch().setInputPlaceholder(this.getParam("MAIN_UI_FILTER__PLACEHOLDER"))}else{this.getSearch().setInputPlaceholder(this.getParam("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"))}this.closePopup()},resetFilter:function(t){var e=this.getSearch();var s=this.getPreset();if(!t){e.getInput().value=""}e.removePreset();s.deactivateAllPresets();s.resetPreset(true);this.applyFilter(true,true)},_onEditButtonClick:function(){if(!this.isEditEnabled()){this.enableEdit()}else{this.disableEdit()}},enableFieldsDragAndDrop:function(){var t=this.getPreset().getFields();this.fieldsList=[];if(BX.type.isArray(t)){this.fieldsList=t.map(this.registerDragItem,this)}},registerDragItem:function(t){var e=this.getDragButton(t);e.onbxdragstart=BX.delegate(this._onFieldDragStart,this);e.onbxdragstop=BX.delegate(this._onFieldDragStop,this);e.onbxdrag=BX.delegate(this._onFieldDrag,this);jsDD.registerObject(e);jsDD.registerDest(e);return t},unregisterDragItem:function(t){var e=this.getDragButton(t);jsDD.unregisterObject(e);jsDD.unregisterDest(e)},_onFieldDragStart:function(){this.dragItem=this.getFields().getField(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.fieldsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onFieldDragStop:function(){BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.fieldsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);this.fieldsList=this.getPreset().getFields();this.saveFieldsSort()},_onFieldDrag:function(){var t=this;var e,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.fieldsList.forEach(function(i,a){if(i){e=i.getBoundingClientRect();s=e.top+BX.scrollTop(window)+e.height/2;if(a>t.dragIndex&&t.sortOffset>s&&i.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if(a<t.dragIndex&&t.sortOffset<s&&i.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if((a<t.dragIndex&&t.sortOffset>s||a>t.dragIndex&&t.sortOffset<s)&&i.style.transform!=="translate3d(0px, 0px, 0px)"){if(i.style.transform!==""){t.targetItem=i}BX.style(i,"transform","translate3d(0px, 0px, 0px)");BX.style(i,"transition","300ms")}}})},disableFieldsDragAndDrop:function(){if(BX.type.isArray(this.fieldsList)&&this.fieldsList.length){this.fieldsList.map(this.unregisterDragItem,this)}},enablePresetsDragAndDrop:function(){var t,e,s,i;t=this.getPreset();e=t.getPresets();this.presetsList=[];if(BX.type.isArray(e)&&e.length){e.forEach(function(e){i=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&i!=="default_filter"&&!BX.hasClass(e,this.settings.classDefaultFilter)){s=this.getDragButton(e);s.onbxdragstart=BX.delegate(this._onDragStart,this);s.onbxdragstop=BX.delegate(this._onDragStop,this);s.onbxdrag=BX.delegate(this._onDrag,this);jsDD.registerObject(s);jsDD.registerDest(s);this.presetsList.push(e)}},this)}},getDragButton:function(t){return BX.Filter.Utils.getByClass(t,this.settings.classPresetDragButton)},disablePresetsDragAndDrop:function(){if(BX.type.isArray(this.presetsList)&&this.presetsList.length){this.presetsList.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){jsDD.unregisterObject(t);jsDD.unregisterDest(t)}},this)}},_onDragStart:function(){this.dragItem=this.getPreset().normalizePreset(jsDD.current_node);this.dragIndex=BX.Filter.Utils.getIndex(this.presetsList,this.dragItem);this.dragRect=this.dragItem.getBoundingClientRect();this.offset=this.dragRect.height;this.dragStartOffset=jsDD.start_y-(this.dragRect.top+BX.scrollTop(window));BX.Filter.Utils.styleForEach(this.list,{transition:"100ms"});BX.addClass(this.dragItem,this.settings.classPresetOndrag);BX.bind(document,"mousemove",BX.delegate(this._onMouseMove,this))},_onMouseMove:function(t){this.realX=t.clientX;this.realY=t.clientY},getDragOffset:function(){return jsDD.x-this.startDragOffset-this.dragRect.left},_onDragStop:function(){var t,e;BX.unbind(document,"mousemove",BX.delegate(this._onMouseMove,this));BX.removeClass(this.dragItem,this.settings.classPresetOndrag);BX.Filter.Utils.styleForEach(this.presetsList,{transition:"",transform:""});BX.Filter.Utils.collectionSort(this.dragItem,this.targetItem);t=this.getPreset();e=t.getPresets();this.presetsList=[];if(BX.type.isArray(e)&&e.length){e.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)&&!BX.hasClass(t,this.settings.classDefaultFilter)){this.presetsList.push(t)}},this)}},_onDrag:function(){var t=this;var e,s;this.dragOffset=this.realY-this.dragRect.top-this.dragStartOffset;this.sortOffset=t.realY+BX.scrollTop(window);BX.Filter.Utils.styleForEach([this.dragItem],{transition:"0ms",transform:"translate3d(0px, "+this.dragOffset+"px, 0px)"});this.presetsList.forEach(function(i,a){if(i){e=i.getBoundingClientRect();s=e.top+BX.scrollTop(window)+e.height/2;if(a>t.dragIndex&&t.sortOffset>s&&i.style.transform!=="translate3d(0px, "+-t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+-t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if(a<t.dragIndex&&t.sortOffset<s&&i.style.transform!=="translate3d(0px, "+t.offset+"px, 0px)"&&i.style.transform!==""){t.targetItem=i;BX.style(i,"transform","translate3d(0px, "+t.offset+"px, 0px)");BX.style(i,"transition","300ms")}if((a<t.dragIndex&&t.sortOffset>s||a>t.dragIndex&&t.sortOffset<s)&&i.style.transform!=="translate3d(0px, 0px, 0px)"){if(i.style.transform!==""){t.targetItem=i}BX.style(i,"transform","translate3d(0px, 0px, 0px)");BX.style(i,"transition","300ms")}}})},getSidebarControlsContainer:function(){if(!BX.type.isDomNode(this.sidebarControlsContainer)){this.sidebarControlsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classSidebarControlsContainer)}return this.sidebarControlsContainer},enableEdit:function(){var t=this.getPreset();var e=t.getPresets();var s;if(BX.type.isArray(e)&&e.length){e.forEach(function(e){s=t.getPresetId(e);if(!BX.hasClass(e,this.settings.classAddPresetField)&&s!=="default_filter"){BX.addClass(e,this.settings.classPresetEdit)}},this)}this.getSaveForAllButton()&&BX.removeClass(this.getSaveForAllButton(),this.settings.classWaitButtonClass);this.enablePresetsDragAndDrop();BX.show(this.getButtonsContainer());BX.hide(this.getPresetButtonsContainer());BX.addClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=BX.clone(this.getParam("PRESETS"));this.isEditEnabledState=true},disableEdit:function(){var t=this.getPreset();var e=t.getPresets();if(BX.type.isArray(e)&&e.length){e.forEach(function(t){if(!BX.hasClass(t,this.settings.classAddPresetField)){BX.removeClass(t,this.settings.classPresetEdit);this.getPreset().disableEditPresetName(t)}},this)}this.disablePresetsDragAndDrop();if(!this.isAddPresetEnabled()){BX.style(this.getButtonsContainer(),"display","")}BX.show(this.getPresetButtonsContainer());BX.removeClass(this.getSidebarControlsContainer(),this.settings.classDisabled);this.editablePresets=null;this.isEditEnabledState=false;this.applyFilter(null,true)},getPresetButtonsContainer:function(){if(!BX.type.isDomNode(this.presetButtonsContainer)){this.presetButtonsContainer=BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classPresetButtonsContainer)}return this.presetButtonsContainer},isEditEnabled:function(){return this.isEditEnabledState},getEditButton:function(){return BX.Filter.Utils.getByClass(this.getFilter(),this.settings.classEditButton)},getParam:function(t,e){return this.params[t]?this.params[t]:e},getFilter:function(){return BX.Filter.Utils.getByClass(this.popup.contentContainer,this.settings.classFilterContainer)},getSearch:function(){if(!(this.search instanceof BX.Filter.Search)){this.search=new BX.Filter.Search(this)}return this.search},_onRestoreButtonClick:function(){var t={CONFIRM:true,CONFIRM_MESSAGE:this.getParam("CONFIRM_MESSAGE"),CONFIRM_APPLY_BUTTON:this.getParam("CONFIRM_APPLY"),CONFIRM_CANCEL_BUTTON:this.getParam("CONFIRM_CANCEL")};this.confirmDialog(t,BX.delegate(this.restoreFilter,this))},confirmDialog:function(t,e,s){var i,a;if("CONFIRM"in t&&t.CONFIRM){i=new BX.PopupWindow(this.getParam("FILTER_ID")+"-confirm-dialog",null,{content:'<div class="main-ui-filter-confirm-content">'+t.CONFIRM_MESSAGE+"</div>",titleBar:"CONFIRM_TITLE"in t?t.CONFIRM_TITLE:"",autoHide:false,zIndex:9999,overlay:.4,offsetTop:-100,closeIcon:true,closeByEsc:true,buttons:[new BX.PopupWindowButton({text:t.CONFIRM_APPLY_BUTTON,events:{click:function(){BX.type.isFunction(e)?e():null;this.popupWindow.close();this.popupWindow.destroy()}}}),new BX.PopupWindowButtonLink({text:t.CONFIRM_CANCEL_BUTTON,events:{click:function(){BX.type.isFunction(s)?s():null;this.popupWindow.close();this.popupWindow.destroy()}}})]});BX.addCustomEvent(i,"onPopupClose",BX.delegate(function(){this.getSaveForAllButton()&&BX.removeClass(this.getSaveForAllButton(),this.settings.classWaitButtonClass)},this));if(!i.isShown()){i.show();a=i.popupContainer;BX.removeClass(a,this.settings.classAnimationShow);BX.addClass(a,this.settings.classAnimationShow)}}else{BX.type.isFunction(e)?e():null}}}})();(function(){BX.Main.filterManager={data:{},push:function(t,e){if(BX.type.isNotEmptyString(t)&&e){this.data[t]=e}},getById:function(t){var e=null;if(t in this.data){e=this.data[t]}return e}}})();
//# sourceMappingURL=script.map.js